<!DOCTYPE html>
<html>
<head>
    <title>javascript自定义事件监听localStorage变化</title>
</head>
<body>
<script>
    var orignalSetItem = window.localStorage.setItem;
    var setItemEvent = new window.Event('setItemEvent');
    window.localStorage.setItem = function(key, newValue) {
        setItemEvent.key = key;
        setItemEvent.oldValue = window.localStorage.getItem('key');
        setItemEvent.newValue = newValue;
        window.dispatchEvent(setItemEvent);
        orignalSetItem.apply(this, arguments);
    }
    window.addEventListener('setItemEvent', function (e) {
        console.log([e.newValue, e]);
    });
    window.localStorage.setItem('testitem', '11111111');
    
    // 测试ing
    if (window.addEventListener) {
        window.addEventListener("storage", handle_storage, false);
    } else {
        window.attachEvent("onstorage", handle_storage);
    };
    function handle_storage(e) {
        if (!e) { e = window.event; }
        console.log(e);
    }
</script>
</body>
</html>